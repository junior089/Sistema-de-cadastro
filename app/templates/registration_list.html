<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar Cadastros - Sistema INCRA</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2c5530;
            --primary-light: #4a7c59;
            --secondary: #1e3a8a;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --info: #0ea5e9;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border: #d1d5db;
            --border-focus: #2c5530;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .brand-info h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .brand-info .subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--success);
            color: white;
            border-radius: 25px;
            font-size: 0.875rem;
            font-weight: 500;
            border: none;
            transition: all 0.3s ease;
        }

        .real-time-indicator.disconnected {
            background: var(--error);
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-danger {
            background: var(--error);
            color: white;
            border-color: var(--error);
        }

        .btn-info {
            background: var(--info);
            color: white;
            border-color: var(--info);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background: var(--bg-primary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            transition: all 0.3s ease;
        }

        .stat-card.clickable {
            cursor: pointer;
        }

        .stat-card.clickable:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-change {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-weight: 600;
        }

        .stat-change.positive {
            background: #dcfce7;
            color: var(--success);
        }

        .stat-change.negative {
            background: #fee2e2;
            color: var(--error);
        }

        .filters-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .filters-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .filters-toggle {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .quick-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .quick-filter-btn {
            padding: 0.75rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 25px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quick-filter-btn:hover {
            background: var(--bg-primary);
            transform: translateY(-2px);
        }

        .quick-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(44, 85, 48, 0.3);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .filters-advanced {
            display: none;
            border-top: 2px solid var(--border);
            padding-top: 2rem;
            margin-top: 2rem;
            animation: slideDown 0.3s ease;
        }

        .filters-advanced.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .active-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .filter-tag .remove {
            cursor: pointer;
            margin-left: 0.25rem;
            opacity: 0.8;
            padding: 0.25rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .filter-tag .remove:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .filters-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .table-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 2px solid var(--border);
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .table-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .results-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .results-count {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--bg-primary);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            border-bottom: 2px solid var(--border);
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: all 0.2s ease;
        }

        th:hover {
            background: #e5e7eb;
        }

        th.sortable::after {
            content: '\f0dc';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 1rem;
            opacity: 0.3;
            transition: all 0.2s ease;
        }

        th.sort-asc::after {
            content: '\f0de';
            opacity: 1;
            color: var(--primary);
        }

        th.sort-desc::after {
            content: '\f0dd';
            opacity: 1;
            color: var(--primary);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
            vertical-align: middle;
        }

        tr:hover {
            background: var(--bg-primary);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.atendida {
            background: #dcfce7;
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-badge.nao-atendida {
            background: #fee2e2;
            color: var(--error);
            border: 1px solid var(--error);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.view {
            background: var(--info);
            color: white;
        }

        .action-btn.toggle {
            background: var(--warning);
            color: white;
        }

        .action-btn.toggle.atendida {
            background: var(--success);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 2rem;
            border-top: 2px solid var(--border);
            background: var(--bg-primary);
        }

        .pagination-btn {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--bg-primary);
            transform: translateY(-2px);
        }

        .pagination-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0 1rem;
            font-weight: 500;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--error);
            color: white;
            border-color: var(--error);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .detail-item {
            padding: 1.5rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .detail-item:hover {
            box-shadow: var(--shadow);
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            letter-spacing: 0.5px;
        }

        .detail-value {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
        }

        .detail-value.empty {
            color: var(--text-secondary);
            font-style: italic;
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 350px;
            transform: translateX(120%);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--error);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--info);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .empty-state-desc {
            font-size: 1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Responsividade aprimorada */
        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .filters-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .table-actions {
                justify-content: space-between;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }

            .quick-filters {
                justify-content: center;
            }

            .filters-actions {
                justify-content: center;
            }

            .pagination {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .modal-content {
                padding: 1.5rem;
                width: 95%;
                margin: 1rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            th,
            td {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            .toast {
                right: 1rem;
                left: 1rem;
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }

        /* Animações adicionais */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Melhorias de acessibilidade */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Estados de foco melhorados */
        .btn:focus,
        .form-control:focus,
        .action-btn:focus,
        .pagination-btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Indicadores de carregamento */
        .btn.loading {
            position: relative;
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="brand-info">
                    <h1>MUTIRÃO DA MULHER RURAL</h1>
                    <div class="subtitle">Sistema de Visualização de Cadastros</div>
                </div>
            </div>

            <div class="header-actions">
                <div class="real-time-indicator" id="connectionStatus">
                    <div class="pulse"></div>
                    <span>Conectado</span>
                </div>

                <a href="{{ url_for('cadastro.fila_chamadas') }}" class="btn btn-info">
                    <i class="fas fa-list-ol"></i>
                    Fila de Chamadas
                </a>

                <a href="{{ url_for('cadastro.index_cadastro') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Novo Cadastro
                </a>

                <a href="{{ url_for('auth.logout') }}" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i>
                    Sair
                </a>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Estatísticas Aprimoradas -->
        <div class="stats-grid fade-in">
            <div class="stat-card clickable" onclick="applyQuickFilter('all')"
                title="Clique para ver todos os cadastros">
                <div class="stat-number" id="totalCadastros">{{ cadastros|length }}</div>
                <div class="stat-label">Total de Cadastros</div>
                <div class="stat-change positive" id="totalChange">+0</div>
            </div>

            <div class="stat-card clickable" onclick="applyQuickFilter('atendidos')"
                title="Clique para ver apenas atendidos">
                <div class="stat-number" style="color: var(--success);" id="totalAtendidos">
                    {{ cadastros|selectattr('cadastro.atendida')|list|length }}
                </div>
                <div class="stat-label">Atendidos</div>
                <div class="stat-change positive" id="atendidosChange">+0</div>
            </div>

            <div class="stat-card clickable" onclick="applyQuickFilter('nao_atendidos')"
                title="Clique para ver não atendidos">
                <div class="stat-number" style="color: var(--error);" id="totalNaoAtendidos">
                    {{ cadastros|rejectattr('cadastro.atendida')|list|length }}
                </div>
                <div class="stat-label">Não Atendidos</div>
                <div class="stat-change negative" id="naoAtendidosChange">+0</div>
            </div>

            <div class="stat-card" title="Percentual de atendimento">
                <div class="stat-number" style="color: var(--info);" id="percentualAtendimento">
                    {% if cadastros|length > 0 %}
                    {{ ((cadastros|selectattr('cadastro.atendida')|list|length / cadastros|length) * 100)|round(1) }}%
                    {% else %}
                    0%
                    {% endif %}
                </div>
                <div class="stat-label">Taxa de Atendimento</div>
            </div>
        </div>

        <!-- Seção de Filtros Aprimorada -->
        <div class="filters-section slide-up">
            <div class="filters-header">
                <h2 class="filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros de Busca
                </h2>
                <div class="filters-toggle">
                    <button type="button" class="btn btn-outline btn-sm" onclick="toggleAdvancedFilters()"
                        id="advancedToggle">
                        <i class="fas fa-cog"></i>
                        Filtros Avançados
                    </button>
                    <button type="button" class="btn btn-outline btn-sm" onclick="clearAllFilters()">
                        <i class="fas fa-times"></i>
                        Limpar Tudo
                    </button>
                </div>
            </div>

            <!-- Filtros Rápidos Aprimorados -->
            <div class="quick-filters">
                <button class="quick-filter-btn active" data-filter="all" onclick="applyQuickFilter('all')">
                    <i class="fas fa-list"></i> Todos
                </button>
                <button class="quick-filter-btn" data-filter="atendidos" onclick="applyQuickFilter('atendidos')">
                    <i class="fas fa-check-circle"></i> Atendidos
                </button>
                <button class="quick-filter-btn" data-filter="nao_atendidos"
                    onclick="applyQuickFilter('nao_atendidos')">
                    <i class="fas fa-clock"></i> Não Atendidos
                </button>
                <button class="quick-filter-btn" data-filter="hoje" onclick="applyQuickFilter('hoje')">
                    <i class="fas fa-calendar-day"></i> Hoje
                </button>
                <button class="quick-filter-btn" data-filter="semana" onclick="applyQuickFilter('semana')">
                    <i class="fas fa-calendar-week"></i> Esta Semana
                </button>
                <button class="quick-filter-btn" data-filter="mes" onclick="applyQuickFilter('mes')">
                    <i class="fas fa-calendar-alt"></i> Este Mês
                </button>
            </div>

            <!-- Filtros Ativos -->
            <div class="active-filters" id="activeFilters">
                <!-- Filtros ativos aparecerão aqui dinamicamente -->
            </div>

            <!-- Formulário de Filtros -->
            <form method="GET" id="filterForm">
                <div class="filters-grid">
                    <div class="form-group">
                        <label for="nome" class="form-label">
                            <i class="fas fa-user"></i> Nome
                        </label>
                        <input type="text" id="nome" name="nome" class="form-control"
                            placeholder="Digite o nome completo..." value="{{ filtros_ativos.nome or '' }}"
                            autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label for="cpf" class="form-label">
                            <i class="fas fa-id-card"></i> CPF
                        </label>
                        <input type="text" id="cpf" name="cpf" class="form-control" placeholder="000.000.000-00"
                            value="{{ filtros_ativos.cpf or '' }}" maxlength="14">
                    </div>

                    <div class="form-group">
                        <label for="estado" class="form-label">
                            <i class="fas fa-map"></i> Estado
                        </label>
                        <select id="estado" name="estado" class="form-control" onchange="updateMunicipios(this.value)">
                            <option value="">Todos os estados</option>
                            {% for estado in estados %}
                            <option value="{{ estado.id }}" {% if filtros_ativos.estado==estado.id|string %}selected{%
                                endif %}>
                                {{ estado.nome }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="status" class="form-label">
                            <i class="fas fa-check-circle"></i> Status
                        </label>
                        <select id="status" name="status" class="form-control">
                            <option value="">Todos os status</option>
                            <option value="atendidos" {% if filtros_ativos.status=='atendidos' %}selected{% endif %}>
                                ✅ Atendidos
                            </option>
                            <option value="nao_atendidos" {% if filtros_ativos.status=='nao_atendidos' %}selected{%
                                endif %}>
                                ⏳ Não Atendidos
                            </option>
                        </select>
                    </div>
                </div>

                <!-- Filtros Avançados -->
                <div class="filters-advanced" id="advancedFilters">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label for="municipio" class="form-label">
                                <i class="fas fa-map-marker-alt"></i> Município
                            </label>
                            <select id="municipio" name="municipio" class="form-control">
                                <option value="">Todos os municípios</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="descricao" class="form-label">
                                <i class="fas fa-tag"></i> Descrição/Serviço
                            </label>
                            <select id="descricao" name="descricao" class="form-control">
                                <option value="">Todas as descrições</option>
                                {% for descricao in descricoes %}
                                <option value="{{ descricao.id }}" {% if filtros_ativos.descricao==descricao.id|string
                                    %}selected{% endif %}>
                                    {{ descricao.nome }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="data_inicio" class="form-label">
                                <i class="fas fa-calendar-plus"></i> Data Início
                            </label>
                            <input type="date" id="data_inicio" name="data_inicio" class="form-control"
                                value="{{ filtros_ativos.data_inicio or '' }}">
                        </div>

                        <div class="form-group">
                            <label for="data_fim" class="form-label">
                                <i class="fas fa-calendar-minus"></i> Data Fim
                            </label>
                            <input type="date" id="data_fim" name="data_fim" class="form-control"
                                value="{{ filtros_ativos.data_fim or '' }}">
                        </div>

                        <div class="form-group">
                            <label for="telefone" class="form-label">
                                <i class="fas fa-phone"></i> Telefone
                            </label>
                            <input type="text" id="telefone" name="telefone" class="form-control"
                                placeholder="(00) 00000-0000" value="{{ filtros_ativos.telefone or '' }}">
                        </div>

                        <div class="form-group">
                            <label for="assentamento" class="form-label">
                                <i class="fas fa-home"></i> Assentamento
                            </label>
                            <input type="text" id="assentamento" name="assentamento" class="form-control"
                                placeholder="Nome do assentamento..." value="{{ filtros_ativos.assentamento or '' }}">
                        </div>
                    </div>
                </div>

                <div class="filters-actions">
                    <button type="submit" class="btn btn-primary" id="filterBtn">
                        <i class="fas fa-search"></i>
                        Aplicar Filtros
                    </button>
                    <button type="button" class="btn btn-success" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        Exportar Excel
                    </button>
                    <button type="button" class="btn btn-info" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i>
                        Gerar Relatório
                    </button>
                    <button type="button" class="btn btn-warning" onclick="printTable()">
                        <i class="fas fa-print"></i>
                        Imprimir
                    </button>
                </div>
            </form>
        </div>

        <!-- Tabela de Cadastros Aprimorada -->
        <div class="table-section slide-up">
            <div class="table-header">
                <h2 class="table-title">
                    <i class="fas fa-table"></i>
                    Lista de Cadastros
                </h2>
                <div class="table-actions">
                    <div class="results-info">
                        <span class="results-count" id="resultsCount">{{ cadastros|length }}</span>
                        <span>resultado(s) encontrado(s)</span>
                        <span id="filterInfo"></span>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline btn-sm" onclick="toggleTableView()"
                            title="Alternar visualização">
                            <i class="fas fa-th-list"></i>
                        </button>
                        <button type="button" class="btn btn-outline btn-sm" onclick="refreshData()"
                            title="Atualizar dados">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button type="button" class="btn btn-outline btn-sm" onclick="toggleFullscreen()"
                            title="Tela cheia">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                {% if cadastros %}
                <table id="cadastrosTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="data_hora" title="Clique para ordenar por data">
                                <i class="fas fa-calendar"></i>
                                Data/Hora
                            </th>
                            <th class="sortable" data-sort="nome" title="Clique para ordenar por nome">
                                <i class="fas fa-user"></i>
                                Nome
                            </th>
                            <th class="sortable" data-sort="cpf" title="Clique para ordenar por CPF">
                                <i class="fas fa-id-card"></i>
                                CPF
                            </th>
                            <th>
                                <i class="fas fa-phone"></i>
                                Telefone
                            </th>
                            <th>
                                <i class="fas fa-map-marker-alt"></i>
                                Localização
                            </th>
                            <th>
                                <i class="fas fa-tag"></i>
                                Serviço
                            </th>
                            <th class="sortable" data-sort="atendida" title="Clique para ordenar por status">
                                <i class="fas fa-check-circle"></i>
                                Status
                            </th>
                            <th>
                                <i class="fas fa-cogs"></i>
                                Ações
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        {% for item in cadastros %}
                        <tr data-id="{{ item.cadastro.id }}" class="cadastro-row"
                            data-status="{{ 'atendida' if item.cadastro.atendida else 'nao-atendida' }}">
                            <td>
                                <div style="font-weight: 600;">{{ item.cadastro.data_hora.strftime('%d/%m/%Y') }}</div>
                                <small style="color: var(--text-secondary);">{{
                                    item.cadastro.data_hora.strftime('%H:%M:%S') }}</small>
                            </td>
                            <td>
                                <div style="font-weight: 600;">{{ item.cadastro.nome }}</div>
                                {% if item.atendente_nome %}
                                <small style="color: var(--text-secondary);">
                                    <i class="fas fa-user-tie"></i>
                                    {{ item.atendente_nome }}
                                </small>
                                {% endif %}
                            </td>
                            <td>
                                <code
                                    style="background: var(--bg-primary); padding: 0.25rem 0.5rem; border-radius: 4px;">
                                    {{ item.cadastro.cpf[:3] }}.{{ item.cadastro.cpf[3:6] }}.{{ item.cadastro.cpf[6:9] }}-{{ item.cadastro.cpf[9:] }}
                                </code>
                            </td>
                            <td>
                                {% if item.cadastro.telefone %}
                                <div>{{ item.cadastro.telefone }}</div>
                                {% else %}
                                <span style="color: var(--text-secondary); font-style: italic;">Não informado</span>
                                {% endif %}
                            </td>
                            <td>
                                <div style="font-weight: 500;">
                                    {{ item.cadastro.municipio.nome if item.cadastro.municipio else 'N/A' }}
                                </div>
                                <small style="color: var(--text-secondary);">
                                    {{ item.cadastro.estado.nome }}
                                </small>
                            </td>
                            <td>
                                <div style="font-weight: 500;">{{ item.cadastro.descricao.nome }}</div>
                                {% if item.cadastro.assentamento %}
                                <small style="color: var(--text-secondary);">
                                    <i class="fas fa-home"></i>
                                    {{ item.cadastro.assentamento[:30] }}{% if item.cadastro.assentamento|length > 30
                                    %}...{% endif %}
                                </small>
                                {% endif %}
                            </td>
                            <td>
                                <span
                                    class="status-badge {{ 'atendida' if item.cadastro.atendida else 'nao-atendida' }}">
                                    <i
                                        class="fas {{ 'fa-check-circle' if item.cadastro.atendida else 'fa-clock' }}"></i>
                                    {{ 'Atendida' if item.cadastro.atendida else 'Pendente' }}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn view" onclick="viewDetails({{ item.cadastro.id }})"
                                        title="Ver detalhes completos">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    {% if current_user.role in ['admin', 'visor'] %}
                                    <button class="action-btn toggle {{ 'atendida' if item.cadastro.atendida else '' }}"
                                        onclick="toggleStatus({{ item.cadastro.id }})"
                                        title="{{ 'Marcar como pendente' if item.cadastro.atendida else 'Marcar como atendida' }}">
                                        <i class="fas {{ 'fa-times' if item.cadastro.atendida else 'fa-check' }}"></i>
                                    </button>
                                    {% endif %}
                                    <form
                                        action="{{ url_for('cadastro.chamar_beneficiaria', cadastro_id=item.cadastro.id) }}"
                                        method="post" target="_blank" style="display:inline;">
                                        <button type="submit" class="btn btn-success" title="Chamar beneficiária">
                                            <i class="fas fa-bullhorn"></i> Chamar
                                        </button>
                                    </form>
                                    <a href="{{ url_for('cadastro.historico_chamadas', cadastro_id=item.cadastro.id) }}"
                                        target="_blank" class="btn btn-info" title="Ver histórico de chamadas">
                                        <i class="fas fa-history"></i> Histórico
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3 class="empty-state-title">Nenhum cadastro encontrado</h3>
                    <p class="empty-state-desc">
                        Não foram encontrados cadastros com os filtros aplicados.<br>
                        Tente ajustar os critérios de busca ou
                        <a href="{{ url_for('cadastro.index_cadastro') }}" class="btn btn-primary"
                            style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i>
                            Criar um novo cadastro
                        </a>
                    </p>
                </div>
                {% endif %}
            </div>

            <!-- Paginação Aprimorada -->
            {% if cadastros %}
            <div class="pagination" id="pagination">
                <!-- Paginação será gerada dinamicamente pelo JavaScript -->
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal de Detalhes Aprimorado -->
    <div class="modal" id="detailsModal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">
                    <i class="fas fa-user"></i>
                    Detalhes do Cadastro
                </h3>
                <button class="modal-close" onclick="closeModal()" aria-label="Fechar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalBody">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Carregando detalhes...
                </div>
            </div>
        </div>
    </div>

    <!-- Toast de Notificação Aprimorado -->
    <div class="toast" id="toast" role="alert" aria-live="polite">
        <i class="fas fa-check-circle toast-icon"></i>
        <div>
            <div style="font-weight: 600;" id="toast-title">Sucesso!</div>
            <div id="toast-message">Operação realizada com sucesso!</div>
        </div>
        <button onclick="hideToast()"
            style="background: none; border: none; color: inherit; cursor: pointer; margin-left: auto;">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- JavaScript Aprimorado -->
    <script>
        // Variáveis globais
        let currentSort = { column: 'data_hora', direction: 'desc' };
        let currentPage = 1;
        let itemsPerPage = 25;
        let allCadastros = [];
        let filteredCadastros = [];
        let eventSource = null;
        let isFullscreen = false;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function () {
            initializeData();
            initializeEventSource();
            initializeMasks();
            updateActiveFilters();
            setupTableSorting();
            setupKeyboardShortcuts();
            loadUserPreferences();
        });

        // Inicializar dados
        function initializeData() {
            allCadastros = Array.from(document.querySelectorAll('.cadastro-row')).map(row => ({
                id: row.dataset.id,
                element: row,
                data: extractRowData(row)
            }));
            filteredCadastros = [...allCadastros];
            updatePagination();
            updateStats();
        }

        // Extrair dados da linha
        function extractRowData(row) {
            const cells = row.querySelectorAll('td');
            return {
                data_hora: cells[0].textContent.trim(),
                nome: cells[1].querySelector('div').textContent.trim(),
                cpf: cells[2].textContent.trim(),
                telefone: cells[3].textContent.trim(),
                municipio_estado: cells[4].textContent.trim(),
                descricao: cells[5].textContent.trim(),
                atendida: row.dataset.status === 'atendida'
            };
        }

        // Inicializar Server-Sent Events
        function initializeEventSource() {
            if (typeof (EventSource) !== "undefined") {
                eventSource = new EventSource('/events');

                eventSource.onopen = function () {
                    updateConnectionStatus(true);
                };

                eventSource.onmessage = function (event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleRealtimeUpdate(data);
                    } catch (e) {
                        console.error('Erro ao processar evento:', e);
                    }
                };

                eventSource.onerror = function () {
                    updateConnectionStatus(false);
                    setTimeout(() => {
                        if (eventSource.readyState === EventSource.CLOSED) {
                            initializeEventSource();
                        }
                    }, 5000);
                };
            }
        }

        // Atualizar status da conexão
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connectionStatus');
            if (connected) {
                indicator.className = 'real-time-indicator';
                indicator.innerHTML = '<div class="pulse"></div><span>Conectado</span>';
            } else {
                indicator.className = 'real-time-indicator disconnected';
                indicator.innerHTML = '<div class="pulse"></div><span>Reconectando...</span>';
            }
        }

        // Processar atualizações em tempo real
        function handleRealtimeUpdate(data) {
            switch (data.type) {
                case 'new_cadastro':
                    showToast('Novo cadastro adicionado!', 'Novo cadastro foi registrado no sistema.', 'info');
                    setTimeout(() => refreshData(), 2000);
                    break;
                case 'status_updated':
                    showToast('Status atualizado!', 'Status de atendimento foi alterado.', 'success');
                    updateRowStatus(data.data.id, data.data.atendida);
                    break;
                case 'heartbeat':
                    // Manter conexão viva
                    break;
            }
        }

        // Inicializar máscaras
        function initializeMasks() {
            // Máscara de CPF
            const cpfInput = document.getElementById('cpf');
            if (cpfInput) {
                cpfInput.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            }

            // Máscara de telefone
            const telefoneInput = document.getElementById('telefone');
            if (telefoneInput) {
                telefoneInput.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length <= 10) {
                        value = value.replace(/(\d{2})(\d)/, '($1) $2');
                        value = value.replace(/(\d{4})(\d)/, '$1-$2');
                    } else {
                        value = value.replace(/(\d{2})(\d)/, '($1) $2');
                        value = value.replace(/(\d{5})(\d)/, '$1-$2');
                    }
                    e.target.value = value;
                });
            }
        }

        // Configurar atalhos de teclado
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function (e) {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'f':
                            e.preventDefault();
                            document.getElementById('nome').focus();
                            break;
                        case 'r':
                            e.preventDefault();
                            refreshData();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportData();
                            break;
                    }
                }

                if (e.key === 'Escape') {
                    closeModal();
                    hideToast();
                }
            });
        }

        // Aplicar filtro rápido
        function applyQuickFilter(filter) {
            // Atualizar botões ativos
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

            // Aplicar filtro
            const form = document.getElementById('filterForm');
            const statusSelect = document.getElementById('status');
            const dataInicio = document.getElementById('data_inicio');
            const dataFim = document.getElementById('data_fim');

            // Limpar filtros anteriores
            form.reset();

            const hoje = new Date().toISOString().split('T')[0];
            const semanaAtras = new Date();
            semanaAtras.setDate(semanaAtras.getDate() - 7);
            const mesAtras = new Date();
            mesAtras.setMonth(mesAtras.getMonth() - 1);

            switch (filter) {
                case 'atendidos':
                    statusSelect.value = 'atendidos';
                    break;
                case 'nao_atendidos':
                    statusSelect.value = 'nao_atendidos';
                    break;
                case 'hoje':
                    dataInicio.value = hoje;
                    dataFim.value = hoje;
                    break;
                case 'semana':
                    dataInicio.value = semanaAtras.toISOString().split('T')[0];
                    dataFim.value = hoje;
                    break;
                case 'mes':
                    dataInicio.value = mesAtras.toISOString().split('T')[0];
                    dataFim.value = hoje;
                    break;
            }

            // Aplicar filtro com loading
            const filterBtn = document.getElementById('filterBtn');
            filterBtn.classList.add('loading');

            setTimeout(() => {
                form.submit();
            }, 300);
        }

        // Alternar filtros avançados
        function toggleAdvancedFilters() {
            const advanced = document.getElementById('advancedFilters');
            const toggle = document.getElementById('advancedToggle');

            advanced.classList.toggle('show');

            if (advanced.classList.contains('show')) {
                toggle.innerHTML = '<i class="fas fa-cog"></i> Ocultar Avançados';
            } else {
                toggle.innerHTML = '<i class="fas fa-cog"></i> Filtros Avançados';
            }
        }

        // Limpar todos os filtros
        function clearAllFilters() {
            document.getElementById('filterForm').reset();
            document.getElementById('municipio').innerHTML = '<option value="">Todos os municípios</option>';

            // Resetar filtros rápidos
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-filter="all"]').classList.add('active');

            showToast('Filtros limpos!', 'Todos os filtros foram removidos.', 'info');

            setTimeout(() => {
                window.location.href = window.location.pathname;
            }, 1000);
        }

        // Atualizar filtros ativos
        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            const params = new URLSearchParams(window.location.search);
            container.innerHTML = '';

            const filterLabels = {
                nome: 'Nome',
                cpf: 'CPF',
                estado: 'Estado',
                municipio: 'Município',
                descricao: 'Descrição',
                status: 'Status',
                data_inicio: 'Data Início',
                data_fim: 'Data Fim',
                telefone: 'Telefone',
                assentamento: 'Assentamento'
            };

            let filterCount = 0;
            params.forEach((value, key) => {
                if (value && filterLabels[key]) {
                    filterCount++;
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        ${filterLabels[key]}: ${value}
                        <span class="remove" onclick="removeFilter('${key}')" title="Remover filtro">&times;</span>
                    `;
                    container.appendChild(tag);
                }
            });

            // Atualizar info dos filtros
            const filterInfo = document.getElementById('filterInfo');
            if (filterInfo) {
                if (filterCount > 0) {
                    filterInfo.textContent = ` (${filterCount} filtro${filterCount > 1 ? 's' : ''} ativo${filterCount > 1 ? 's' : ''})`;
                } else {
                    filterInfo.textContent = '';
                }
            }
        }

        // Remover filtro específico
        function removeFilter(key) {
            const url = new URL(window.location);
            url.searchParams.delete(key);
            showToast('Filtro removido!', `Filtro "${key}" foi removido.`, 'info');
            setTimeout(() => {
                window.location.href = url.toString();
            }, 500);
        }

        // Atualizar municípios
        async function updateMunicipios(estadoId) {
            const municipioSelect = document.getElementById('municipio');

            if (!estadoId) {
                municipioSelect.innerHTML = '<option value="">Todos os municípios</option>';
                return;
            }

            try {
                municipioSelect.innerHTML = '<option value="">Carregando...</option>';
                const response = await fetch(`/get_municipios/${estadoId}`);
                const municipios = await response.json();

                municipioSelect.innerHTML = '<option value="">Todos os municípios</option>';
                municipios.forEach(municipio => {
                    const option = document.createElement('option');
                    option.value = municipio.id;
                    option.textContent = municipio.nome;
                    municipioSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Erro ao carregar municípios:', error);
                municipioSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                showToast('Erro!', 'Erro ao carregar municípios.', 'error');
            }
        }

        // Configurar ordenação da tabela
        function setupTableSorting() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function () {
                    const column = this.dataset.sort;
                    sortTable(column);
                });
            });
        }

        // Ordenar tabela
        function sortTable(column) {
            const direction = (currentSort.column === column && currentSort.direction === 'asc') ? 'desc' : 'asc';
            currentSort = { column, direction };

            // Atualizar indicadores visuais
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            document.querySelector(`th[data-sort="${column}"]`).classList.add(`sort-${direction}`);

            // Ordenar dados
            filteredCadastros.sort((a, b) => {
                let aVal = a.data[column];
                let bVal = b.data[column];

                if (column === 'atendida') {
                    aVal = aVal ? 1 : 0;
                    bVal = bVal ? 1 : 0;
                }

                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            renderTable();
            showToast('Tabela ordenada!', `Ordenado por ${column} (${direction === 'asc' ? 'crescente' : 'decrescente'}).`, 'info');
        }

        // Renderizar tabela
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageItems = filteredCadastros.slice(start, end);

            // Ocultar todas as linhas
            allCadastros.forEach(item => {
                item.element.style.display = 'none';
            });

            // Mostrar apenas as linhas da página atual
            pageItems.forEach(item => {
                item.element.style.display = '';
                tbody.appendChild(item.element);
            });

            updatePagination();
        }

        // Atualizar paginação
        function updatePagination() {
            const totalPages = Math.ceil(filteredCadastros.length / itemsPerPage);
            const pagination = document.getElementById('pagination');

            if (!pagination) return;

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            pagination.innerHTML = '';

            // Botão anterior
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => changePage(currentPage - 1);
            prevBtn.title = 'Página anterior';
            pagination.appendChild(prevBtn);

            // Números das páginas
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'pagination-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => changePage(1);
                pagination.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-info';
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => changePage(i);
                pagination.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-info';
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'pagination-btn';
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => changePage(totalPages);
                pagination.appendChild(lastBtn);
            }

            // Botão próximo
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => changePage(currentPage + 1);
            nextBtn.title = 'Próxima página';
            pagination.appendChild(nextBtn);

            // Informações da página
            const info = document.createElement('span');
            info.className = 'pagination-info';
            info.textContent = `Página ${currentPage} de ${totalPages} (${filteredCadastros.length} registros)`;
            pagination.appendChild(info);
        }

        // Mudar página
        function changePage(page) {
            currentPage = page;
            renderTable();

            // Scroll suave para o topo da tabela
            document.querySelector('.table-section').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Ver detalhes do cadastro
        async function viewDetails(id) {
            const modal = document.getElementById('detailsModal');
            const modalBody = document.getElementById('modalBody');

            modal.classList.add('show');
            modal.setAttribute('aria-hidden', 'false');
            modalBody.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Carregando detalhes...
                </div>
            `;

            try {
                const response = await fetch(`/api/cadastro/${id}`);
                if (!response.ok) throw new Error('Erro ao carregar dados');

                const cadastro = await response.json();

                modalBody.innerHTML = `
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Nome Completo</div>
                            <div class="detail-value">${cadastro.nome}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">CPF</div>
                            <div class="detail-value">${formatCPF(cadastro.cpf)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Telefone</div>
                            <div class="detail-value ${!cadastro.telefone ? 'empty' : ''}">${cadastro.telefone || 'Não informado'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Assentamento/Endereço</div>
                            <div class="detail-value">${cadastro.assentamento}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Município</div>
                            <div class="detail-value">${cadastro.municipio.nome}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Estado</div>
                            <div class="detail-value">${cadastro.estado.nome}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Serviço/Descrição</div>
                            <div class="detail-value">${cadastro.descricao.nome}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Instituição</div>
                            <div class="detail-value">${cadastro.instituicao.nome}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Data/Hora do Cadastro</div>
                            <div class="detail-value">${formatDateTime(cadastro.data_hora)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status de Atendimento</div>
                            <div class="detail-value">
                                <span class="status-badge ${cadastro.atendida ? 'atendida' : 'nao-atendida'}">
                                    <i class="fas ${cadastro.atendida ? 'fa-check-circle' : 'fa-clock'}"></i>
                                    ${cadastro.atendida ? 'Atendida' : 'Pendente'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao carregar detalhes:', error);
                modalBody.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="empty-state-title">Erro ao carregar detalhes</h3>
                        <p class="empty-state-desc">Ocorreu um erro ao carregar os detalhes do cadastro. Tente novamente.</p>
                        <button class="btn btn-primary" onclick="viewDetails(${id})">
                            <i class="fas fa-redo"></i>
                            Tentar novamente
                        </button>
                    </div>
                `;
            }
        }

        // Alternar status de atendimento
        async function toggleStatus(id) {
            const button = event.target.closest('.action-btn');
            const originalContent = button.innerHTML;

            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            button.disabled = true;

            try {
                const response = await fetch(`/toggle_atendimento/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                if (data.success) {
                    showToast('Status alterado!', data.message, 'success');
                    updateRowStatus(id, data.atendida);
                    updateStats();
                } else {
                    showToast('Erro!', data.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao alterar status:', error);
                showToast('Erro!', 'Erro ao alterar status de atendimento.', 'error');
            } finally {
                button.innerHTML = originalContent;
                button.disabled = false;
            }
        }

        // Atualizar status da linha
        function updateRowStatus(cadastroId, atendida) {
            const row = document.querySelector(`tr[data-id="${cadastroId}"]`);
            if (row) {
                const statusCell = row.querySelector('.status-badge');
                const toggleBtn = row.querySelector('.action-btn.toggle');

                row.dataset.status = atendida ? 'atendida' : 'nao-atendida';

                if (atendida) {
                    statusCell.className = 'status-badge atendida';
                    statusCell.innerHTML = '<i class="fas fa-check-circle"></i> Atendida';
                    toggleBtn.className = 'action-btn toggle atendida';
                    toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                    toggleBtn.title = 'Marcar como pendente';
                } else {
                    statusCell.className = 'status-badge nao-atendida';
                    statusCell.innerHTML = '<i class="fas fa-clock"></i> Pendente';
                    toggleBtn.className = 'action-btn toggle';
                    toggleBtn.innerHTML = '<i class="fas fa-check"></i>';
                    toggleBtn.title = 'Marcar como atendida';
                }
            }
        }

        // Fechar modal
        function closeModal() {
            const modal = document.getElementById('detailsModal');
            modal.classList.remove('show');
            modal.setAttribute('aria-hidden', 'true');
        }

        // Atualizar dados
        function refreshData() {
            const refreshBtn = event?.target || document.querySelector('[onclick="refreshData()"]');
            if (refreshBtn) {
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            }

            showToast('Atualizando...', 'Recarregando dados do servidor.', 'info');

            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        // Alternar visualização da tabela
        function toggleTableView() {
            // Implementar diferentes visualizações (compacta, expandida, cards)
            const table = document.getElementById('cadastrosTable');
            table.classList.toggle('compact-view');

            showToast('Visualização alterada!', 'Modo de visualização da tabela foi alterado.', 'info');
        }

        // Alternar tela cheia
        function toggleFullscreen() {
            const tableSection = document.querySelector('.table-section');

            if (!isFullscreen) {
                if (tableSection.requestFullscreen) {
                    tableSection.requestFullscreen();
                } else if (tableSection.webkitRequestFullscreen) {
                    tableSection.webkitRequestFullscreen();
                } else if (tableSection.msRequestFullscreen) {
                    tableSection.msRequestFullscreen();
                }
                isFullscreen = true;
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                isFullscreen = false;
            }
        }

        // Exportar dados
        function exportData() {
            // Pega os filtros ativos da URL
            const params = window.location.search;
            window.open(`/export_cadastros${params}`, '_blank');
        }

        // Gerar relatório
        function generateReport() {
            const params = window.location.search;
            window.open(`/relatorio_cadastros${params}`, '_blank');
        }

        // Imprimir tabela
        function printTable() {
            const printWindow = window.open('', '_blank');
            const tableHTML = document.querySelector('.table-container').innerHTML;
            printWindow.document.write(`
                <html>
                <head>
                    <title>Lista de Cadastros - MUTIRÃO DA MULHER RURAL</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .action-buttons, .status-badge.nao-atendida, .status-badge.atendida { display: none !important; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <h1>MUTIRÃO DA MULHER RURAL</h1>
                    <h2>Lista de Cadastros</h2>
                    <p>Data de impressão: ${new Date().toLocaleString('pt-BR')}</p>
                    ${tableHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Atualizar estatísticas
        function updateStats() {
            const total = allCadastros.length;
            const atendidos = allCadastros.filter(item => item.data.atendida).length;
            const naoAtendidos = total - atendidos;
            const percentual = total > 0 ? ((atendidos / total) * 100).toFixed(1) : 0;

            document.getElementById('totalCadastros').textContent = total;
            document.getElementById('totalAtendidos').textContent = atendidos;
            document.getElementById('totalNaoAtendidos').textContent = naoAtendidos;
            document.getElementById('percentualAtendimento').textContent = `${percentual}%`;
            document.getElementById('resultsCount').textContent = filteredCadastros.length;
        }

        // Mostrar toast aprimorado
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const titleEl = document.getElementById('toast-title');
            const messageEl = document.getElementById('toast-message');
            const icon = toast.querySelector('.toast-icon');

            titleEl.textContent = title;
            messageEl.textContent = message;
            toast.className = `toast ${type}`;

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            icon.className = `fas ${icons[type] || icons.success} toast-icon`;

            toast.classList.add('show');
            setTimeout(() => hideToast(), 5000);
        }

        // Ocultar toast
        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        // Funções utilitárias
        function formatCPF(cpf) {
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        function formatDateTime(dateTime) {
            const date = new Date(dateTime);
            return date.toLocaleString('pt-BR');
        }

        // Carregar preferências do usuário
        function loadUserPreferences() {
            const savedItemsPerPage = localStorage.getItem('itemsPerPage');
            if (savedItemsPerPage) {
                itemsPerPage = parseInt(savedItemsPerPage);
            }
        }

        // Salvar preferências do usuário
        function saveUserPreferences() {
            localStorage.setItem('itemsPerPage', itemsPerPage);
        }

        // Event listeners
        document.getElementById('detailsModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Cleanup ao sair da página
        window.addEventListener('beforeunload', function () {
            if (eventSource) {
                eventSource.close();
            }
            saveUserPreferences();
        });

        // Detectar mudanças de fullscreen
        document.addEventListener('fullscreenchange', function () {
            isFullscreen = !!document.fullscreenElement;
        });
    </script>
</body>

</html>